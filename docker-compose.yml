networks:
  frontend:
    name: frontend

volumes:
  changedetection-data:
    external: true
    name: "changedetection-data"

services:
  changedetection:
    image: dgtlmoon/changedetection.io:latest
    container_name: changedetection
    hostname: changedetection
    environment:
      - BASE_URL=http://changeio.${DOMAIN}
      - PLAYWRIGHT_DRIVER_URL=ws://browser-chrome:3000/?stealth=1&--disable-web-security=true
      - HIDE_REFERER=true
    links:
      - browser-chrome
    volumes:
      - changedetection-data:/datastore
      - /etc/timezone:/etc/timezone:ro
      - /etc/localtime:/etc/localtime:ro
    ports:
      - "5000:5000"
    restart: unless-stopped
    networks:
      - frontend
    depends_on:
      browser-chrome:
        condition: service_started
    labels:
      - traefik.enable=true
      - traefik.http.routers.changeio.rule=Host(`changeio.${DOMAIN}`)
      - traefik.http.routers.changeio.entrypoints=web
      - traefik.http.services.changeio.loadbalancer.server.port=5000

  browser-chrome:
    hostname: browser-chrome
    container_name: browser-chrome
    image: browserless/chrome:latest
    environment:
      - SCREEN_WIDTH=1920
      - SCREEN_HEIGHT=1024
      - SCREEN_DEPTH=16
      - CONNECTION_TIMEOUT=300000
      - MAX_CONCURRENT_SESSIONS=5
      - FETCH_WORKERS=5
    ports:
      - "3000:3000"
    shm_size: "2g"
    networks:
      - frontend
    volumes:
      - /dev/shm:/dev/shm
      - /etc/timezone:/etc/timezone:ro
      - /etc/localtime:/etc/localtime:ro
    restart: unless-stopped
